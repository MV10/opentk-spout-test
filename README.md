# opentk-spout-test

Wires up the basics of [Spout2](https://github.com/leadedge/Spout2) send / receive of OpenGL textures.

The project accepts one of three command-line arguments:
* `sender` copies program output to one or more receivers
* `receiver` copies another program's output using a shared texture
* `alloc` is a receiver mode using an internally-allocated texture

> NOTE: Spout2 has a bug with the shared texture commands, so `receiver` mode is not currently working. The Spout2 maintainer is aware of this and working on a fix.

An optional second argument is a Spout sender name (enclosed in quotes if the name includes spaces). For sender mode, the name identifies the sender. The default sender name is "test" if none is specified. For receiver modes, the name identifies the sender to receive from. If it is not specified, the receiver attaches to the first sender it finds.

Sender mode runs a simple plasma-color shader. Receiver mode applies a ripple effect shader to the incoming texture. Use the Spout2 sample programs for testing (version info and link below).

### Dependencies

Note that my [eyecandy](https://github.com/MV10/eyecandy) library is used as a convenience. It provides some basic functionality from the [OpenTK](https://github.com/opentk/opentk) windowing support, shader compilation, and uniform handling, but it's entirely incidental to the Spout processing. OpenTK itself is a thin wrapper around OpenGL and GLFW windowing APIs.

### Spout Interop

This demonstration includes the Spout 2.007.017 DLL which is copied to the output directory. Interop bindings and wrappers were generated by xAI's Grok by analyzing the DLL and the SDK [documentation](https://spoutgl-site.netlify.app/). 

The process of generating interop declarations and wrappers this way is time-consuming and difficult. In the repo's SpoutInterop/GrokInputs directory is a text file explaining the process. Once those steps are completed, a lot of review is necessary as Grok will omit things or (occasionally write bad code that won't compile. Still, it's far better than my luck getting ChatGPT to do this (in addition to refusing to produce complete output, it will also argue with you, which is ridiculous).

Previously I was using the [Spout.NETCore](https://github.com/AWAS666/Spout.NETCore) bindings, but they are outdated and currently CppPlus (which generated those bindings) is several years out of date and incompatible with Clang 19 currently shipping with VS2022. While the CppPlus repo is somewhat active, the NuGet package is no longer being maintained and a recent PR to fix the NuGet packing automation has apparently not received attention. The original maintainer of the .NET Framework-oriented Spout.NET noted manual cleanup of that output was required, too, and he probably didn't have AI to do all the heavy lifting. (The Spout.NETCore maintainer found a way to ignore Clang compatibility errors, but the output seemed unchanged so presumably that wrapper still won't work.)

I am also going to experiment with Microsoft's own [ClangSharp](https://github.com/dotnet/ClangSharp) and the generator. An automated approach would certainly be faster and easier if it works, Grok required about two hours of hand-holding after the initial code was generated to finally have the coverage a basic send/receive scenario needs.

<img width="991" height="1063" alt="image" src="https://github.com/user-attachments/assets/1facb76d-5115-4b76-a307-80bd6e70f2cc" />

